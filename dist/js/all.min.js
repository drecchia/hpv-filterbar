const HpvFilterBar={CssClassName:{ROOT:"hpv-filter-bar",IS_READONLY:"is-readonly",FLOATING_CONTENT:"floating-content",FLOATING_CONTENT_HEADER:"floating-content-header",FLOATING_CONTENT_BODY:"floating-content-body",PICKER_BTN:"picker-btn",PICKER_ITEM:"filter-content-item",PICKER_FLOATING_CONTENT:"picker-floating-content",SELECTOR_BTN:"selector-btn",SELECTOR_BTN_DISABLED:"selector-btn-disabled",SELECTOR_BTN_TEXT:"selector-btn-text",SELECTOR_BTN_ARROW_CONTAINER:"selector-btn-arrow-container",SELECTOR_BTN_ARROW:"selector-btn-arrow"},Bar:class{constructor(t,e={}){this.options={pickerBtnTitle:"Select filter",attachDropdown:(t,e)=>{},afterToggleDropdown:(t,e)=>{},afterCreated:t=>{},afterRemoveSelector:(t,e)=>{},...e},this.container=document.getElementById(t),this.filters=new Map,this.pickerBtn=null,this.init()}init(){this.container.classList.add(HpvFilterBar.CssClassName.ROOT),this.pickerBtn=new HpvFilterBar.PickerBtn(this),this.setupEventListeners(),this.doCallbackCreatedEvent()}doCallbackCreatedEvent(){this.options.afterCreated&&this.options.afterCreated instanceof Function&&this.options.afterCreated(this)}setupEventListeners(){this.container.addEventListener("pickerBtnItemSelection",t=>{t.stopImmediatePropagation();const e=t.detail.filter,s=e.getSelector();e.reachedInstancesLimit()?console.error("Max instances reached for filter "+e.getId()):(s.addToScreen(),e.instances++,this.pickerBtn.toggleFloatingContentVisibility(),e.reachedInstancesLimit()&&this.pickerBtn.disableMenuEntry(e.getId()))}),this.container.addEventListener("filterBtnItemSelection",t=>{t.stopImmediatePropagation();const e=t.detail.filter;console.log("Opening dropdown for filter "+e.getId());const s=e.getSelector(),i=s.createDom();if(!i)return;const n=i.parentNode;let o=null;if(n&&n.classList.contains(HpvFilterBar.CssClassName.FLOATING_CONTENT_BODY))o=n.parentNode;else{(o=document.createElement("div")).classList.add(HpvFilterBar.CssClassName.FLOATING_CONTENT,e.getId()+"-floating-content");const t=document.createElement("div");t.classList.add(HpvFilterBar.CssClassName.FLOATING_CONTENT_HEADER);const s=document.createElement("strong");s.innerHTML="Filtros";const n=document.createElement("div");n.classList.add("remove-selector"),n.addEventListener("click",()=>{this.removeSelector(e.getId()),o.style.display="block"==o.style.display?"none":"block"}),t.appendChild(s),t.appendChild(n),o.appendChild(t);const r=document.createElement("div");r.classList.add(HpvFilterBar.CssClassName.FLOATING_CONTENT_BODY),o.appendChild(r),r.appendChild(i),this.container.appendChild(o)}const r=t.detail.target;this.options.attachDropdown(r,o),"block"==o.style.display?(o.style.display="none",s.updateLabel()):o.style.display="block"})}removeSelector(t){const e=this.filters.get(t);e&&(e.removeFromScreen(),this.options.afterRemoveSelector&&this.options.afterRemoveSelector instanceof Function&&this.options.afterRemoveSelector(this,e))}addFilter(t){t.setBar(this),this.filters.set(t.getId(),t);const e=t.getPicker();e.setContext(t),this.pickerBtn.addPicker(e);const s=t.getSelector();s.setContext(t),s.options.immediateDisplay&&(s.addToScreen(),t.instances++,t.processMaxInstances()),this.options.onFilterAdded&&this.options.onFilterAdded instanceof Function&&this.options.onFilterAdded(this,t)}getAllRules(){let t=[];return this.filters.forEach(e=>{e.instances>0&&t.push(e.getRules())}),t}},Context:class{constructor(t={}){this.options={picker:new HpvFilterBar.ItemPicker,selector:new HpvFilterBar.Selector,afterRemoveFromBar:(t,e)=>{},maxInstances:1,...t},t.id||(t.id="filter-"+Math.random().toString(36).substring(7)),this.parent=null,this.instances=0,this.allowMoreInstances=!0}getId(){return this.options.id}getLabel(){return this.options.picker.label}getFaIcon(){return this.options.picker.faIcon}getPicker(){return this.options.picker}getSelector(){return this.options.selector}reachedInstancesLimit(){return this.instances>=this.options.maxInstances}immediateUpdateLabel(){this.getSelector().updateLabel()}setBar(t){if(!(t instanceof HpvFilterBar.Bar))throw new Error("Parent must be an instance of HpvFilterBar.Bar");this.parent=t}processMaxInstances(){this.reachedInstancesLimit()?(this.allowMoreInstances=!1,this.parent.pickerBtn.disableMenuEntry(this.options.id)):(this.allowMoreInstances=!0,this.parent.pickerBtn.enableMenuEntry(this.options.id))}removeFromScreen(){console.log(`Removing filter ${this.options.id} from screen`),document.getElementById(this.options.id+"-selector-btn-0").remove(),this.instances--,this.processMaxInstances(),this.doCallbackAfterRemoveFromBar()}doCallbackAfterRemoveFromBar(){this.options.afterRemoveFromBar&&this.options.afterRemoveFromBar(this.parent,this)}getRules(){const t=this.getSelector();return t?t.getRules(this):{}}},PickerBtn:class{constructor(t){this.parent=t,this.options=t.options,this.options.hasOwnProperty("createPickerEl")||(this.options.createPickerEl=(t=>{const e=document.createElement("div");return e.innerHTML=`<span title="${t.pickerBtnTitle}"><i class="fas fa-filter"></i></span>`,e})),this.init()}init(){this.setupPickerBtn(),this.setupFloatingContent()}setupPickerBtn(){const{pickerBtnTitle:t}=this.options,e=this.options.createPickerEl(this.options);e.classList.add(HpvFilterBar.CssClassName.PICKER_BTN),e.addEventListener("click",this.toggleFloatingContentVisibility.bind(this)),this.parent.container.appendChild(e)}disableMenuEntry(t){const e=document.getElementById(t+"-menu-entry");e&&e.classList.add(HpvFilterBar.CssClassName.IS_READONLY)}enableMenuEntry(t){const e=document.getElementById(t+"-menu-entry");e&&e.classList.remove(HpvFilterBar.CssClassName.IS_READONLY)}setupFloatingContent(){const{pickerContentTitle:t,attachDropdown:e}=this.options;if("function"==typeof e){const s=document.createElement("div");s.classList.add(HpvFilterBar.CssClassName.FLOATING_CONTENT,HpvFilterBar.CssClassName.PICKER_FLOATING_CONTENT),s.innerHTML=`\n                        <div class="${HpvFilterBar.CssClassName.FLOATING_CONTENT_HEADER}">\n                            <strong>${t||"Filters"}</strong>\n                        </div>\n                        <div class="${HpvFilterBar.CssClassName.FLOATING_CONTENT_BODY}">\n                        </div>`,this.parent.container.appendChild(s),e(document.querySelector("."+HpvFilterBar.CssClassName.PICKER_BTN),s)}}addPicker(t){const e=document.querySelector("."+HpvFilterBar.CssClassName.PICKER_FLOATING_CONTENT).querySelector("."+HpvFilterBar.CssClassName.FLOATING_CONTENT_BODY);this.options.immediateDisplay&&this.addToScreen(),e.appendChild(t.createMenuEntry())}toggleFloatingContentVisibility(){const t=document.querySelector("."+HpvFilterBar.CssClassName.PICKER_FLOATING_CONTENT);if(t.style.display="block"==t.style.display?"none":"block",this.options.afterToggleDropdown){const e=document.querySelector("."+HpvFilterBar.CssClassName.PICKER_BTN);this.options.afterToggleDropdown(e,t)}}},ItemPicker:class{constructor(t={}){this.options={label:"Filter 1",faIcon:"fas fa-globe",createEl:(t,e)=>{const s=document.createElement("a");return s.href="#",s.innerHTML=`<i class="${e.faIcon} icon"></i> <span class="menu-text">${e.label}</span>`,s},...t}}setContext(t){if(!(t instanceof HpvFilterBar.Context))throw new Error("Parent must be an instance of HpvFilterBar.Context");this.filterCtx=t}createMenuEntry(){const{faIcon:t,label:e,createEl:s}=this.options,i=this.filterCtx.getId(),n=s(this.filterCtx,this.options);return n.id=i+"-menu-entry",n.href="#",n.classList.add(HpvFilterBar.CssClassName.PICKER_ITEM),n.addEventListener("click",t=>{t.preventDefault(),n.dispatchEvent(new CustomEvent("pickerBtnItemSelection",{detail:{filter:this.filterCtx},bubbles:!0,cancelable:!0}))}),n}},Selector:class{constructor(t={}){this.options={label:"Selected",defaultText:"All",immediateDisplay:!1,disabledSelector:!1,onShowDropdown:()=>{},onHideDropdown:()=>{},beforeAddToScreen:(t,e,s)=>{},afterAddToScreen:(t,e,s)=>{},createDom:t=>{},getRules:(t,e)=>[],...t},this.dom=null,this.domDict={}}doCallbackAfterAddToScreen(t){this.options.afterAddToScreen&&this.options.afterAddToScreen instanceof Function&&this.options.afterAddToScreen(t,this.domDict,this.dom)}doCallbackBeforeAddToScreen(t){this.options.beforeAddToScreen&&this.options.beforeAddToScreen instanceof Function&&this.options.beforeAddToScreen(t,this.domDict,this.dom)}createDom(){return!this.dom&&this.options.createDom&&(this.dom=this.options.createDom(this.filterCtx,this.domDict)),this.dom}getRules(t){return this.options.getRules?this.options.getRules(t,this.domDict,this.dom):[]}setContext(t){if(!(t instanceof HpvFilterBar.Context))throw new Error("Parent must be an instance of HpvFilterBar.Context");this.filterCtx=t}updateLabel(){const t=document.getElementById(this.filterCtx.getId()+"-selector-btn-0").querySelector("."+HpvFilterBar.CssClassName.SELECTOR_BTN_TEXT);this.options.constructHtmlLabel&&this.options.constructHtmlLabel instanceof Function?t.innerHTML=this.options.constructHtmlLabel(this.filterCtx,this.domDict,this.dom):t.innerHTML=this.options.label}addToScreen(){this.doCallbackBeforeAddToScreen(this.filterCtx);const t=this.filterCtx.getId();console.log(`Adding selector ${t} to screen`);const e=document.createElement("div");e.classList.add(HpvFilterBar.CssClassName.SELECTOR_BTN),e.id=t+"-selector-btn-"+this.filterCtx.instances;const s=document.createElement("span");s.classList.add(HpvFilterBar.CssClassName.SELECTOR_BTN_TEXT),this.options.constructHtmlLabel&&this.options.constructHtmlLabel instanceof Function?s.innerHTML=this.options.constructHtmlLabel(this.filterCtx,this.domDict,this.dom):s.innerHTML=this.options.label;const i=document.createElement("div");i.classList.add(HpvFilterBar.CssClassName.SELECTOR_BTN_ARROW_CONTAINER);const n=document.createElement("span");n.classList.add(HpvFilterBar.CssClassName.SELECTOR_BTN_ARROW),e.appendChild(s),this.options.disabledSelector?e.classList.add(HpvFilterBar.CssClassName.SELECTOR_BTN_DISABLED):(i.appendChild(n),e.appendChild(i));const o=document.querySelector("."+HpvFilterBar.CssClassName.PICKER_BTN);o.parentNode.insertBefore(e,o),this.options.disabledSelector||e.addEventListener("click",t=>{t.preventDefault(),e.dispatchEvent(new CustomEvent("filterBtnItemSelection",{detail:{filter:this.filterCtx,target:e},bubbles:!0,cancelable:!0}))}),this.doCallbackAfterAddToScreen(this.filterCtx)}}};