const HpvFilterBar={CssClassName:{ROOT:"hpv-filter-bar",IS_READONLY:"is-readonly",FLOATING_CONTENT:"floating-content",FLOATING_CONTENT_HEADER:"floating-content-header",FLOATING_CONTENT_BODY:"floating-content-body",ICON_BTN:"icon-btn",PICKER_BTN:"picker-btn",PICKER_ITEM:"filter-content-item",PICKER_FLOATING_CONTENT:"picker-floating-content",SELECTOR_BTN:"selector-btn",SELECTOR_BTN_DISABLED:"selector-btn-disabled",SELECTOR_BTN_TEXT:"selector-btn-text",SELECTOR_BTN_ARROW_CONTAINER:"selector-btn-arrow-container",SELECTOR_BTN_ARROW:"selector-btn-arrow"},Bar:class{constructor(t,e={}){this.options={pickerBtnTitle:"Select filter",attachDropdown:(t,e)=>{},afterToggleDropdown:(t,e)=>{},afterCreated:t=>{},afterRemoveSelector:(t,e)=>{},onFilterAdded:(t,e)=>{},onFiltersAdded:(t,e)=>{},...e},this.container=document.getElementById(t),this.filters=new Map,this.pickerBtn=null,this.init()}init(){this.container.classList.add(HpvFilterBar.CssClassName.ROOT),this.pickerBtn=new HpvFilterBar.PickerBtn(this),this.setupEventListeners(),this.doCallbackCreatedEvent()}sortVisibleElementsByRank(){const t=this.container,e=Array.from(t.children).filter(t=>"none"!==t.style.display);e.sort((t,e)=>{return(parseInt(t.getAttribute("data-rank"))||1)-(parseInt(e.getAttribute("data-rank"))||1)}),e.forEach(e=>t.appendChild(e))}doCallbackCreatedEvent(){this.options.afterCreated&&this.options.afterCreated instanceof Function&&this.options.afterCreated(this)}setupEventListeners(){this.container.addEventListener("pickerBtnItemSelection",t=>{t.stopImmediatePropagation();const e=t.detail.filter,s=e.getSelector();e.reachedInstancesLimit()?console.error("Max instances reached for filter "+e.getId()):(s.addToScreen(),e.instances++,this.pickerBtn.toggleFloatingContentVisibility(),this.sortVisibleElementsByRank(),e.reachedInstancesLimit()&&this.pickerBtn.disableMenuEntry(e.getId()))}),this.container.addEventListener("filterBtnItemSelection",t=>{t.stopImmediatePropagation();const e=t.detail.filter;console.log("Opening dropdown for filter "+e.getId());const s=e.getSelector(),n=s.constructSelectorFloatingContent();if(!n)return;const i=n.parentNode;let o=null;if(i&&i.classList.contains(HpvFilterBar.CssClassName.FLOATING_CONTENT_BODY))o=i.parentNode;else{(o=document.createElement("div")).classList.add(HpvFilterBar.CssClassName.FLOATING_CONTENT,e.getId()+"-floating-content");const t=document.createElement("div");t.classList.add(HpvFilterBar.CssClassName.FLOATING_CONTENT_HEADER);const i=document.createElement("strong");if(i.innerHTML=s.options.floatingContentTitle||"Filtros",t.appendChild(i),s.options.removable){const s=document.createElement("div");s.classList.add("remove-selector"),s.addEventListener("click",()=>{this.removeSelector(e.getId()),o.style.display="block"==o.style.display?"none":"block"}),t.appendChild(s)}o.appendChild(t);const r=document.createElement("div");r.classList.add(HpvFilterBar.CssClassName.FLOATING_CONTENT_BODY),o.appendChild(r),r.appendChild(n),this.container.appendChild(o)}const r=t.detail.target;this.options.attachDropdown(r,o),"block"==o.style.display?(o.style.display="none",s.updateLabel()):o.style.display="block"})}removeSelector(t){const e=this.filters.get(t);e&&(e.removeFromScreen(),this.options.afterRemoveSelector&&this.options.afterRemoveSelector instanceof Function&&this.options.afterRemoveSelector(this,e))}addFilters(t){t.forEach(t=>{this.addFilter(t)}),this.options.onFiltersAdded&&this.options.onFiltersAdded instanceof Function&&this.options.onFiltersAdded(this,t)}addFilter(t){t.setBar(this),this.filters.set(t.getId(),t);const e=t.getPicker();e&&(e.setContext(t),this.pickerBtn.addPicker(e));const s=t.getSelector();s.setContext(t),s.options.immediateDisplay&&(s.addToScreen(),t.instances++,t.processMaxInstances()),this.options.onFilterAdded&&this.options.onFilterAdded instanceof Function&&this.options.onFilterAdded(this,t)}getAllRules(){let t=[];return this.filters.forEach(e=>{e.instances>0&&t.push(e.getRules())}),t}},Context:class{constructor(t={}){this.options={picker:null,selector:null,afterRemoveFromBar:(t,e)=>{},maxInstances:1,...t},t.id||(t.id="filter-"+Math.random().toString(36).substring(7)),this.parent=null,this.instances=0,this.allowMoreInstances=!0}getId(){return this.options.id}getLabel(){return this.options.picker.label}getFaIcon(){return this.options.picker.faIcon}getPicker(){return this.options.picker}getSelector(){return this.options.selector}reachedInstancesLimit(){return this.instances>=this.options.maxInstances}immediateUpdateLabel(){this.getSelector().updateLabel()}setBar(t){if(!(t instanceof HpvFilterBar.Bar))throw new Error("Parent must be an instance of HpvFilterBar.Bar");this.parent=t}processMaxInstances(){this.reachedInstancesLimit()?(this.allowMoreInstances=!1,this.parent.pickerBtn.disableMenuEntry(this.options.id)):(this.allowMoreInstances=!0,this.parent.pickerBtn.enableMenuEntry(this.options.id))}removeFromScreen(){console.log(`Removing filter ${this.options.id} from screen`),document.getElementById(this.options.id+"-selector-btn-0").remove(),this.instances--,this.processMaxInstances(),this.doCallbackAfterRemoveFromBar()}doCallbackAfterRemoveFromBar(){this.options.afterRemoveFromBar&&this.options.afterRemoveFromBar(this.parent,this)}getRules(){const t=this.getSelector();return t?t.getRules(this):{}}},PickerBtn:class{constructor(t){this.parent=t,this.options=t.options,this.options.hasOwnProperty("createPickerEl")||(this.options.createPickerEl=(t=>{const e=document.createElement("div");return e.innerHTML=`<span title="${t.pickerBtnTitle}"><i class="fas fa-filter"></i></span>`,e})),this.init()}init(){this.setupPickerBtn(),this.setupFloatingContent()}setupPickerBtn(){const{pickerBtnTitle:t}=this.options,e=this.options.createPickerEl(this.options);e.classList.add(HpvFilterBar.CssClassName.PICKER_BTN,HpvFilterBar.CssClassName.ICON_BTN),e.setAttribute("data-rank",100),e.addEventListener("click",this.toggleFloatingContentVisibility.bind(this)),this.parent.container.appendChild(e)}disableMenuEntry(t){const e=document.getElementById(t+"-menu-entry");e&&e.classList.add(HpvFilterBar.CssClassName.IS_READONLY)}enableMenuEntry(t){const e=document.getElementById(t+"-menu-entry");e&&e.classList.remove(HpvFilterBar.CssClassName.IS_READONLY)}setupFloatingContent(){const{pickerContentTitle:t,attachDropdown:e}=this.options;if("function"==typeof e){const s=document.createElement("div");s.classList.add(HpvFilterBar.CssClassName.FLOATING_CONTENT,HpvFilterBar.CssClassName.PICKER_FLOATING_CONTENT),s.innerHTML=`\n                        <div class="${HpvFilterBar.CssClassName.FLOATING_CONTENT_HEADER}">\n                            <strong>${t||"Filters"}</strong>\n                        </div>\n                        <div class="${HpvFilterBar.CssClassName.FLOATING_CONTENT_BODY}">\n                        </div>`,this.parent.container.appendChild(s),e(document.querySelector("."+HpvFilterBar.CssClassName.PICKER_BTN),s)}}addPicker(t){const e=document.querySelector("."+HpvFilterBar.CssClassName.PICKER_FLOATING_CONTENT).querySelector("."+HpvFilterBar.CssClassName.FLOATING_CONTENT_BODY);this.options.immediateDisplay&&this.addToScreen(),e.appendChild(t.createMenuEntry())}toggleFloatingContentVisibility(){const t=document.querySelector("."+HpvFilterBar.CssClassName.PICKER_FLOATING_CONTENT);if(t.style.display="block"==t.style.display?"none":"block",this.options.afterToggleDropdown){const e=document.querySelector("."+HpvFilterBar.CssClassName.PICKER_BTN);this.options.afterToggleDropdown(e,t)}}},ItemPicker:class{constructor(t={}){this.options={label:"Filter 1",faIcon:"fas fa-globe",createEl:(t,e)=>{const s=document.createElement("a");return s.href="#",s.innerHTML=`<i class="${e.faIcon} icon"></i> <span class="menu-text">${e.label}</span>`,s},...t}}setContext(t){if(!(t instanceof HpvFilterBar.Context))throw new Error("Parent must be an instance of HpvFilterBar.Context");this.filterCtx=t}createMenuEntry(){const{faIcon:t,label:e,createEl:s}=this.options,n=this.filterCtx.getId(),i=s(this.filterCtx,this.options);return i.id=n+"-menu-entry",i.href="#",i.classList.add(HpvFilterBar.CssClassName.PICKER_ITEM),i.addEventListener("click",t=>{t.preventDefault(),i.dispatchEvent(new CustomEvent("pickerBtnItemSelection",{detail:{filter:this.filterCtx},bubbles:!0,cancelable:!0}))}),i}},Selector:class{constructor(t={}){this.options={label:"Selected",defaultText:"All",floatingContentTitle:"Filters",immediateDisplay:!1,disabledSelector:!1,removable:!0,rank:10,onShowDropdown:()=>{},onHideDropdown:()=>{},beforeAddToScreen:(t,e,s)=>{},afterAddToScreen:(t,e,s)=>{},constructSelectorFloatingContent:t=>{},getRules:(t,e)=>[],constructSelector:null,constructSelectorContent:null,constructSelectorFloatingContent:null,...t},this.dom=null,this.domDict={}}doCallbackAfterAddToScreen(t){this.options.afterAddToScreen&&this.options.afterAddToScreen instanceof Function&&this.options.afterAddToScreen(t,this.domDict,this.dom)}doCallbackBeforeAddToScreen(t){this.options.beforeAddToScreen&&this.options.beforeAddToScreen instanceof Function&&this.options.beforeAddToScreen(t,this.domDict,this.dom)}constructSelectorFloatingContent(){return!this.dom&&this.options.constructSelectorFloatingContent&&(this.dom=this.options.constructSelectorFloatingContent(this.filterCtx,this.domDict)),this.dom}getRules(t){return this.options.getRules?this.options.getRules(t,this.domDict,this.dom):[]}setContext(t){if(!(t instanceof HpvFilterBar.Context))throw new Error("Parent must be an instance of HpvFilterBar.Context");this.filterCtx=t}updateLabel(){const t=document.getElementById(this.filterCtx.getId()+"-selector-btn-0").querySelector("."+HpvFilterBar.CssClassName.SELECTOR_BTN_TEXT);if(t)if(this.options.constructSelectorContent&&this.options.constructSelectorContent instanceof Function){const e=this.options.constructSelectorContent(this.filterCtx,this.domDict,this.dom);e instanceof HTMLElement?(t.innerHTML="",t.appendChild(e)):console.error("Content must be an instance of HTMLElement")}else t.innerHTML=this.options.label;else console.error("Selector text not found")}addToScreen(){this.doCallbackBeforeAddToScreen(this.filterCtx);const t=this.filterCtx.getId();console.log(`Adding selector ${t} to screen`);let e=null;if(this.options.constructSelector&&this.options.constructSelector instanceof Function)(e=this.options.constructSelector(this.filterCtx,this.domDict)).id=t+"-selector-btn-"+this.filterCtx.instances;else{(e=document.createElement("div")).classList.add(HpvFilterBar.CssClassName.SELECTOR_BTN),e.id=t+"-selector-btn-"+this.filterCtx.instances;const s=document.createElement("span");if(s.classList.add(HpvFilterBar.CssClassName.SELECTOR_BTN_TEXT),this.options.constructSelectorContent&&this.options.constructSelectorContent instanceof Function){const t=this.options.constructSelectorContent(this.filterCtx,this.domDict,this.dom);t instanceof HTMLElement?s.appendChild(t):console.error("Content must be an instance of HTMLElement")}else s.innerHTML=this.options.label;const n=document.createElement("div");n.classList.add(HpvFilterBar.CssClassName.SELECTOR_BTN_ARROW_CONTAINER);const i=document.createElement("span");i.classList.add(HpvFilterBar.CssClassName.SELECTOR_BTN_ARROW),e.appendChild(s),this.options.disabledSelector?e.classList.add(HpvFilterBar.CssClassName.SELECTOR_BTN_DISABLED):(n.appendChild(i),e.appendChild(n))}null===e.getAttribute("data-rank")&&e.setAttribute("data-rank",this.options.rank||10);const s=document.querySelector("."+HpvFilterBar.CssClassName.PICKER_BTN);s.parentNode.insertBefore(e,s),this.options.disabledSelector||e.addEventListener("click",t=>{t.preventDefault(),e.dispatchEvent(new CustomEvent("filterBtnItemSelection",{detail:{filter:this.filterCtx,target:e},bubbles:!0,cancelable:!0}))}),this.doCallbackAfterAddToScreen(this.filterCtx)}}};