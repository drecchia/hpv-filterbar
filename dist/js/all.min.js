const HpvFilterBar={CssClassName:{ROOT:"hpv-filter-bar",IS_READONLY:"is-readonly",FLOATING_CONTENT:"floating-content",FLOATING_CONTENT_HEADER:"floating-content-header",FLOATING_CONTENT_BODY:"floating-content-body",PICKER_BTN:"picker-btn",PICKER_ITEM:"filter-content-item",PICKER_FLOATING_CONTENT:"picker-floating-content",SELECTOR_BTN:"selector-btn",SELECTOR_BTN_DISABLED:"selector-btn-disabled",SELECTOR_BTN_TEXT:"selector-btn-text",SELECTOR_BTN_ARROW_CONTAINER:"selector-btn-arrow-container",SELECTOR_BTN_ARROW:"selector-btn-arrow"},Bar:class{constructor(t,e={}){this.options={pickerBtnTitle:"Select filter",attachDropdown:(t,e)=>{},onToggleDropdown:(t,e)=>{},...e},this.container=document.getElementById(t),this.filters=new Map,this.pickerBtn=null,this.init()}init(){this.container.classList.add(HpvFilterBar.CssClassName.ROOT),this.pickerBtn=new HpvFilterBar.PickerBtn(this),this.setupEventListeners()}setupEventListeners(){this.container.addEventListener("pickerBtnItemSelection",t=>{t.stopImmediatePropagation();const e=t.detail.filter,s=e.getSelector();e.reachedInstancesLimit()?console.log("Max instances reached for filter "+e.getId()):(s.addToScreen(),e.instances++,this.pickerBtn.toggleFloatingContentVisibility(),e.reachedInstancesLimit()&&this.pickerBtn.disableMenuEntry(e.getId()))}),this.container.addEventListener("filterBtnItemSelection",t=>{t.stopImmediatePropagation();const e=t.detail.filter;console.log("Opening dropdown for filter "+e.getId());const s=e.getSelector(),n=s.createDom();if(!n)return;const i=n.parentNode;let r=null;if(i&&i.classList.contains(HpvFilterBar.CssClassName.FLOATING_CONTENT_BODY))r=i.parentNode;else{(r=document.createElement("div")).classList.add(HpvFilterBar.CssClassName.FLOATING_CONTENT,e.getId()+"-floating-content");const t=document.createElement("div");t.classList.add(HpvFilterBar.CssClassName.FLOATING_CONTENT_HEADER);const s=document.createElement("strong");s.innerHTML="Filtros";const i=document.createElement("div");i.classList.add("remove-filter"),i.addEventListener("click",()=>{this.removeFilter(e.getId()),r.style.display="block"==r.style.display?"none":"block"}),t.appendChild(s),t.appendChild(i),r.appendChild(t);const o=document.createElement("div");o.classList.add(HpvFilterBar.CssClassName.FLOATING_CONTENT_BODY),r.appendChild(o),o.appendChild(n),this.container.appendChild(r)}const o=t.detail.target;this.options.attachDropdown(o,r),"block"==r.style.display?(r.style.display="none",s.updateLabel()):r.style.display="block"})}removeFilter(t){const e=this.filters.get(t);e&&e.removeFromScreen()}addFilter(t){t.setBar(this),this.filters.set(t.getId(),t);const e=t.getPicker();e.setContext(t),this.pickerBtn.addPicker(e);const s=t.getSelector();s.setContext(t),s.options.immediateDisplay&&(s.addToScreen(),t.instances++,t.processMaxInstances())}getMergedRules(){return function(t){const e={};return t.forEach(t=>{for(const s in t)e[s]?(Array.isArray(e[s])||(e[s]=[e[s]]),e[s].push(t[s])):e[s]=t[s]}),e}(Array.from(this.filters.values()).filter(t=>t.instances>0).map(t=>t.getRules()).reduce((t,e)=>t.concat(e),[]))}},Context:class{constructor(t={}){this.options={picker:new HpvFilterBar.ItemPicker,selector:new HpvFilterBar.Selector,maxInstances:1,...t},t.id||(t.id="filter-"+Math.random().toString(36).substring(7)),this.parent=null,this.instances=0,this.allowMoreInstances=!0}getId(){return this.options.id}getLabel(){return this.options.picker.label}getFaIcon(){return this.options.picker.faIcon}getPicker(){return this.options.picker}getSelector(){return this.options.selector}reachedInstancesLimit(){return this.instances>=this.options.maxInstances}setBar(t){if(!(t instanceof HpvFilterBar.Bar))throw new Error("Parent must be an instance of HpvFilterBar.Bar");this.parent=t}processMaxInstances(){this.reachedInstancesLimit()?(this.allowMoreInstances=!1,this.parent.pickerBtn.disableMenuEntry(this.options.id)):(this.allowMoreInstances=!0,this.parent.pickerBtn.enableMenuEntry(this.options.id))}removeFromScreen(){console.log(`Removing filter ${this.options.id} from screen`),document.getElementById(this.options.id+"-selector-btn-0").remove(),this.instances--,this.options.onRemoveFromBar&&this.options.onRemoveFromBar(this.parent,this),this.processMaxInstances()}getRules(){const t=this.getSelector();return t?t.getRules(this):{}}},PickerBtn:class{constructor(t){this.parent=t,this.options=t.options,this.options.hasOwnProperty("createPickerEl")||(this.options.createPickerEl=(t=>{const e=document.createElement("div");return e.innerHTML=`<span title="${t.pickerBtnTitle}"><i class="fas fa-filter"></i></span>`,e})),this.init()}init(){this.setupPickerBtn(),this.setupFloatingContent()}setupPickerBtn(){const{pickerBtnTitle:t}=this.options,e=this.options.createPickerEl(this.options);e.classList.add(HpvFilterBar.CssClassName.PICKER_BTN),e.addEventListener("click",this.toggleFloatingContentVisibility.bind(this)),this.parent.container.appendChild(e)}disableMenuEntry(t){const e=document.getElementById(t+"-menu-entry");e&&e.classList.add(HpvFilterBar.CssClassName.IS_READONLY)}enableMenuEntry(t){const e=document.getElementById(t+"-menu-entry");e&&e.classList.remove(HpvFilterBar.CssClassName.IS_READONLY)}setupFloatingContent(){const{pickerContentTitle:t,attachDropdown:e}=this.options;if("function"==typeof e){const s=document.createElement("div");s.classList.add(HpvFilterBar.CssClassName.FLOATING_CONTENT,HpvFilterBar.CssClassName.PICKER_FLOATING_CONTENT),s.innerHTML=`\n                        <div class="${HpvFilterBar.CssClassName.FLOATING_CONTENT_HEADER}">\n                            <strong>${t||"Filters"}</strong>\n                        </div>\n                        <div class="${HpvFilterBar.CssClassName.FLOATING_CONTENT_BODY}">\n                        </div>`,this.parent.container.appendChild(s),e(document.querySelector("."+HpvFilterBar.CssClassName.PICKER_BTN),s)}}addPicker(t){const e=document.querySelector("."+HpvFilterBar.CssClassName.PICKER_FLOATING_CONTENT).querySelector("."+HpvFilterBar.CssClassName.FLOATING_CONTENT_BODY);this.options.immediateDisplay&&this.addToScreen(),e.appendChild(t.createMenuEntry())}toggleFloatingContentVisibility(){const t=document.querySelector("."+HpvFilterBar.CssClassName.PICKER_FLOATING_CONTENT);if(t.style.display="block"==t.style.display?"none":"block",this.options.onToggleDropdown){const e=document.querySelector("."+HpvFilterBar.CssClassName.PICKER_BTN);this.options.onToggleDropdown(e,t)}}},ItemPicker:class{constructor(t={}){this.options={label:"Filter 1",faIcon:"fas fa-globe",createEl:(t,e)=>{const s=document.createElement("a");return s.href="#",s.innerHTML=`<i class="${e.faIcon} icon"></i> <span class="menu-text">${e.label}</span>`,s},...t}}setContext(t){if(!(t instanceof HpvFilterBar.Context))throw new Error("Parent must be an instance of HpvFilterBar.Context");this.filterCtx=t}createMenuEntry(){const{faIcon:t,label:e,createEl:s}=this.options,n=this.filterCtx.getId(),i=s(this.filterCtx,this.options);return i.id=n+"-menu-entry",i.href="#",i.classList.add(HpvFilterBar.CssClassName.PICKER_ITEM),i.addEventListener("click",t=>{t.preventDefault(),i.dispatchEvent(new CustomEvent("pickerBtnItemSelection",{detail:{filter:this.filterCtx},bubbles:!0,cancelable:!0}))}),i}},Selector:class{constructor(t={}){this.options={label:"Selected",defaultText:"All",immediateDisplay:!1,disabledSelector:!1,onShowDropdown:()=>{},onHideDropdown:()=>{},createDom:t=>{},getRules:(t,e)=>[],...t},this.dom=null,this.domDict={}}createDom(){return!this.dom&&this.options.createDom&&(this.dom=this.options.createDom(this.filterCtx,this.domDict)),this.dom}getRules(t){return this.options.getRules?this.options.getRules(t,this.domDict,this.dom):[]}setContext(t){if(!(t instanceof HpvFilterBar.Context))throw new Error("Parent must be an instance of HpvFilterBar.Context");this.filterCtx=t}updateLabel(){const t=document.getElementById(this.filterCtx.getId()+"-selector-btn-0").querySelector("."+HpvFilterBar.CssClassName.SELECTOR_BTN_TEXT);this.options.constructHtmlLabel&&this.options.constructHtmlLabel instanceof Function?t.innerHTML=this.options.constructHtmlLabel(this.filterCtx,this.domDict,this.dom):t.innerHTML=this.options.label}addToScreen(){const t=this.filterCtx.getId();console.log(`Adding selector ${t} to screen`);const e=document.createElement("div");e.classList.add(HpvFilterBar.CssClassName.SELECTOR_BTN),e.id=t+"-selector-btn-"+this.filterCtx.instances;const s=document.createElement("span");s.classList.add(HpvFilterBar.CssClassName.SELECTOR_BTN_TEXT),this.options.constructHtmlLabel&&this.options.constructHtmlLabel instanceof Function?s.innerHTML=this.options.constructHtmlLabel(this.filterCtx,this.domDict,this.dom):s.innerHTML=this.options.label;const n=document.createElement("div");n.classList.add(HpvFilterBar.CssClassName.SELECTOR_BTN_ARROW_CONTAINER);const i=document.createElement("span");i.classList.add(HpvFilterBar.CssClassName.SELECTOR_BTN_ARROW),e.appendChild(s),this.options.disabledSelector?e.classList.add(HpvFilterBar.CssClassName.SELECTOR_BTN_DISABLED):(n.appendChild(i),e.appendChild(n));const r=document.querySelector("."+HpvFilterBar.CssClassName.PICKER_BTN);r.parentNode.insertBefore(e,r),this.options.disabledSelector||e.addEventListener("click",t=>{t.preventDefault(),e.dispatchEvent(new CustomEvent("filterBtnItemSelection",{detail:{filter:this.filterCtx,target:e},bubbles:!0,cancelable:!0}))})}}};